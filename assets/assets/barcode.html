<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="ZXing for JS" />
    <link
      rel="stylesheet"
      rel="preload"
      as="style"
      onload="this.rel='stylesheet';this.onload=null"
      href="https://unpkg.com/normalize.css@8.0.0/normalize.css"
    />
    <link
      rel="stylesheet"
      rel="preload"
      as="style"
      onload="this.rel='stylesheet';this.onload=null"
      href="https://unpkg.com/milligram@1.3.0/dist/milligram.min.css"
    />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }
      .videoInsert {
        position: absolute;
        right: 0;
        bottom: 0;
        min-width: 100%;
        min-height: 100%;
        width: auto;
        z-index: -100;
        background-size: cover;
        overflow: hidden;
      }
    </style>
  </head>

  <body>
    <div>
      <video id="video" class="videoInsert"></video>
    </div>

    <script type="text/javascript" src="./html5-qrcode.min.js"></script>
    <script type="text/javascript">
      window.addEventListener("load", function () {
        let selectedDeviceId;
        const codeReader = new ZXing.BrowserMultiFormatReader();
        console.log("ZXing code reader initialized");
        codeReader
          .listVideoInputDevices()
          .then((videoInputDevices) => {
            codeReader.decodeFromVideoDevice(
              selectedDeviceId,
              "video",
              (result, err) => {
                if (result) {
                  console.log(result);
                  window.parent.postMessage(result, "*");
                }
                if (err && !(err instanceof ZXing.NotFoundException)) {
                  console.error(err);
                  document.getElementById("result").textContent = err;
                }
              }
            );
            console.log(
              `Started continous decode from camera with id ${selectedDeviceId}`
            );
          })
          .catch((err) => {
            console.error(err);
          });
      });
    </script>
  </body>
</html>
